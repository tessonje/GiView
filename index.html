<!DOCTYPE html> 
<html>
    <head>
        <meta charset="utf-8">
        <title>GiView</title>
        <link href="jquery.mobile-1.0.min.css" rel="stylesheet" type="text/css"/>
        <link rel="stylesheet" type="text/css" href="style.css" />
        <script src="jquery-1.6.4.min.js" type="text/javascript"></script>
        <script src="jquery.mobile-1.0.min.js" type="text/javascript"></script>
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
        <!--<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />-->
        <script type="text/javascript">
 			function initialize()
			{
				if (navigator.geolocation)
				{
					navigator.geolocation.getCurrentPosition(function(position)
					{	
						
						if (typeof(Number.prototype.toRad) === "undefined")
						{
	  						Number.prototype.toRad = function()
							{
	 						   return this * Math.PI / 180;
	 						}
						}
						function Dist(lat1, lon1, lat2, lon2)
						{
							var R = 6371; // km
							var dLat = (lat2-lat1).toRad();
							var dLon = (lon2-lon1).toRad();
							var lat1 = lat1.toRad();
							var lat2 = lat2.toRad();
							var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
							var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
							var d = R * c;
							return(d.toFixed(3));
						}
						map = new google.maps.Map(document.getElementById("map_canvas"),
						{
    						zoom: 15,
        					center: new google.maps.LatLng(position.coords.latitude, position.coords.longitude),
							//center: new google.maps.LatLng(50.6360722, 3.0647608),
        					mapTypeId: google.maps.MapTypeId.ROADMAP
      					});
						
						/*var myLatlng = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
						var myMarker = new google.maps.Marker(
						{
							position: myLatlng,
							map: map,
							title: "ma position"
						});
						var myWindowOptions = 
						{
							content:
								'it\'s me MARIO'
						};
						var myInfoWindow = new google.maps.InfoWindow(myWindowOptions);
						google.maps.event.addListener(myMarker, 'click', function() 
						{
							myInfoWindow.open(map,myMarker);
						});
						
						var fnacLat =  50.6360722;
						var fnacLon = 3.0647608;
						//var user_fnac = dist(position.coords.latitude, position.coords.longitude, 50.6360722, 3.0647608);
						//alert("user_fnac");
						var fnacImage = new google.maps.MarkerImage('http://t1.gstatic.com/images?q=tbn:ANd9GcSA9L99C3PR-5UBzPYAOq-nsuD1ddyWzuGN07pJlQCgOOG8heXOjPoKIg');
						var fnacLatlng = new google.maps.LatLng(fnacLat,fnacLon);
						var fnacMarker = new google.maps.Marker(
						{
							position: fnacLatlng, 
							map: map,
							icon: fnacImage,
							title: "fnac Lille"
						});
						var fnacWindowOptions = 
						{
							content:
								'<a href="http://www.fnac.com/"><img src="http://t1.gstatic.com/images?q=tbn:ANd9GcSA9L99C3PR-5UBzPYAOq-nsuD1ddyWzuGN07pJlQCgOOG8heXOjPoKIg"</a></br><p>Adresse : 20 Rue Saint-Nicolas, 59800 lille</br>Téléphone :0 892 35 04 05</p><p>Distance : '+Dist(position.coords.latitude,position.coords.longitude,fnacLat, fnacLon) +' km</p>'
								//'<a href="infofnac.html">FNAC</a>'
						};
						var fnacInfoWindow = new google.maps.InfoWindow(fnacWindowOptions);
						google.maps.event.addListener(fnacMarker, 'click', function() 
						{
							fnacInfoWindow.open(map,fnacMarker);
						});
						
						var furetLat = 50.6366642;
						var furetLon = 3.0631837;
						var furetImage = new google.maps.MarkerImage('https://pbs.twimg.com/profile_images/195765038/logo_furet_normal.png');
						var furetLatlng = new google.maps.LatLng(furetLat,furetLon);
						var furetMarker = new google.maps.Marker(
						{
							position: furetLatlng, 
							map: map,
							icon: furetImage,
							title: "furet Lille"
						});
						var furetWindowOptions = 
						{
							content:
								'<a href="http://www.furet.com/"><img src="https://pbs.twimg.com/profile_images/195765038/logo_furet_normal.png"</a></br><p>Adresse : 15 Place du Général de Gaulle, 59800 Lille</br>Téléphone :03 20 78 43 43</p><p>Distance : '+Dist(position.coords.latitude,position.coords.longitude,furetLat, furetLon) +' km</p>'
								//'<a href="infofuret.html">FURET</a>'
						};
						var furetInfoWindow = new google.maps.InfoWindow(furetWindowOptions);
						google.maps.event.addListener(furetMarker, 'click', function() 
						{
							furetInfoWindow.open(map,furetMarker);
						});
						
						var epitechLat = 50.6351672;
						var epitechLon = 3.0619123;
						var epitechImage = new google.maps.MarkerImage('https://fbcdn-profile-a.akamaihd.net/hprofile-ak-frc3/s48x48/373013_110720126115_1854659391_q.jpg');
						var epitechLatlng = new google.maps.LatLng(epitechLat,epitechLon);
						var epitechMarker = new google.maps.Marker(
						{
							position: epitechLatlng, 
							map: map,
							icon: epitechImage,
							title: "epitech Lille"
						});
						var epitechWindowOptions = 
						{
							content:
								'<a href="http://www.epitech.eu/"><img src="https://fbcdn-profile-a.akamaihd.net/hprofile-ak-frc3/s48x48/373013_110720126115_1854659391_q.jpg"</a></br><p>Adresse : 5-9, rue du Palais Rihour, 59000 Lille</p><p>Distance : '+Dist(position.coords.latitude,position.coords.longitude,epitechLat, epitechLon) +' km</p>'
								//'<a href="infoepitech.html">EPITECH</a>'
						};
						var epitechInfoWindow = new google.maps.InfoWindow(epitechWindowOptions);
						google.maps.event.addListener(epitechMarker, 'click', function() 
						{
							epitechInfoWindow.open(map,epitechMarker);
						});*/
					var location = [
					{
						lat:position.coords.latitude,
						lon:position.coords.longitude,
						title:'Ma position',
						//flat: true,
						content:'<p>It\'s me mario!!!</p>'
					},
					{
						lat:50.6355677,
						lon:3.0620463,
						distance: Dist(position.coords.latitude,position.coords.longitude, 50.6355677, 3.0620463),
						title:'Rihour',
						//flat: true,
						content:'<div id="siteNotice">'+
						'</div>'+
						'<img src="img/rihour.jpg" height=50 width=30 />'+
						'<p>La Place Rihour à Lille</p><p>Distance: ' + Dist(position.coords.latitude,position.coords.longitude, 50.6355677, 3.0620463) + 'km</p>',
						img:  new google.maps.MarkerImage('img/rihour.jpg', null, null, null, new google.maps.Size(21,30))
					},
					{
						lat:50.6360722,
						lon:3.0647608,
						distance: Dist(position.coords.latitude,position.coords.longitude, 50.6360722, 3.0647608),
						title:'Fnac',
						//flat: true,
						content:'<div id="siteNotice">'+
						'</div>'+
						'<img src="img/fnac.png" height=50 width=30 />'+
						'<p>La Fnac à Lille</p><p>Distance: ' + Dist(position.coords.latitude,position.coords.longitude, 50.6360722, 3.0647608) + 'km</p>',
						img:  new google.maps.MarkerImage('img/fnac.png', null, null, null, new google.maps.Size(21,30))
					},
					{
						lat:50.6191442,
						lon:3.0515611,
						distance: Dist(position.coords.latitude,position.coords.longitude, 50.6191442, 3.0515611),
						title:'Wazemmes',
						//flat: true,
						content:'<div id="siteNotice">'+
						'</div>'+
						'<img src="img/Wazemmes.jpg" height=50 width=30 />'+
						'<p>Le Serpent de Wazemmes à Lille</p><p>Distance: ' + Dist(position.coords.latitude,position.coords.longitude, 50.6191442, 3.0515611) + 'km</p>',
						img:  new google.maps.MarkerImage('img/Wazemmes.jpg', null, null, null, new google.maps.Size(21,30))
						//img:  new google.maps.MarkerImage('img/rihour.jpg')	
					},
					{
						lat:50.6318736,
						lon:3.0534811,
						distance: Dist(position.coords.latitude,position.coords.longitude, 50.6318736, 3.0534811),
						title:'Atomics',
						//flat: true,
						content:'<div id="siteNotice">'+
						'</div>'+
						'<img src="img/atomic.jpg" height=50 width=30 />'+
						'<p>Bar sur Solferino à Lille</p><p>Distance: ' + Dist(position.coords.latitude,position.coords.longitude, 50.6318736, 3.0534811) + 'km</p>',
						img:  new google.maps.MarkerImage('img/atomic.jpg', null, null, null, new google.maps.Size(21,30))
						//img:  new google.maps.MarkerImage('img/rihour.jpg')
					}
					];
					
					for (var i = 0; i < location.length; i++)
					{ 
						// init markers
						//if (i > 0 && location[i].distance < 5)
						//{ 
							var marker = new google.maps.Marker({ position: new google.maps.LatLng(location[i].lat, location[i].lon), map: map, title: location[i].title, icon: location[i].img, flat: true});

							// process multiple info windows
							(function(marker, i) 
							{
								// add click event
								google.maps.event.addListener(marker, 'click', function() { infowindow = new google.maps.InfoWindow({ content: location[i].content });
							 infowindow.open(map, marker);
					 });
					  })(marker, i);//}
					   } })(); 
					//}); 
					//})();
				}
				else
					alert("Votre navigateur ne prend pas en compte la géolocalisation HTML5");
 				
 			}
		</script>
    </head> 
    <body onload="initialize()">
   		<div data-role="page" id="page">
			<div data-role="header">
				<h1>Page One</h1>
			</div>
			<div data-role="content">	
				<ul data-role="listview">
					<li><a href="#map">map</a></li>
                    <!--<li><a href="test.html">test</a></li>-->
				</ul>
			</div>
			<div data-role="footer">
				<h4>Giview</h4>
			</div>
		</div>
		<div data-role="page" id="map">
			<div data-role="header">
				<h1>map</h1>
			</div>
			<div data-role="content">
				<div id="map_canvas"></div>
			</div>
			<div data-role="footer">
				<a href="#page"><h4>return</h4></a>
			</div>
		</div>    
    </body>
</html>
